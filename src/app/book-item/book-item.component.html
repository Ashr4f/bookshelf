<p *ngIf="loading">Loading...</p>
<div *ngIf="!loading">
  <h3>{{ bookData.title }}</h3>

  <div>
    Global rating:
    <nz-rate
      [(ngModel)]="bookNotes"
      [nzTooltips]="tooltips"
      nzAllowHalf
      nzDisabled
    ></nz-rate
    >({{ bookData.reviews.totalCount }})
  </div>

  <!-- <img
    src="{{ bookData.cover }}"
    alt="Book Cover"
    #bookCover
    (error)="
      bookCover.onerror = null;
      bookCover.src = '../assets/images/book-cover-placeholder.png'
    "
  /> -->

  <p *ngIf="bookData.editor">Edited by: {{ bookData.editor }}</p>

  <div *ngIf="BookAvailability && bookInMySchool">
    <p>Available</p>
    <button type="button" (click)="rentCurrentBook()">RENT</button>
  </div>

  <div *ngIf="BookAvailability === false">
    <div *ngIf="bookBorrowerUID === user.owner.uid">
      <p>
        You've borrowed this book, consider returning it when you finish reading
        it please.
      </p>
      <button type="button" (click)="returnCurrentBook()">RETURN BOOK</button>
    </div>

    <div *ngIf="bookBorrowerUID !== user.owner.uid">
      Not available, borrowed by: <span>{{ bookBorrowerName }}</span>
    </div>
  </div>

  <div *ngIf="bookInMySchool === false">
    This book isn't available at your school!
  </div>

  <div>
    <span>My rating: </span>
    <nz-rate
      [(ngModel)]="bookReview"
      [nzTooltips]="tooltips"
      (ngModelChange)="sendBookReview()"
    ></nz-rate>
  </div>
  <div>
    <button routerLink="/books/{{ isbn }}/edit" type="button">EDIT</button>
  </div>

  <h4 style="margin-bottom: 12px;">
    Availabilities:
  </h4>
  <div
    *ngFor="let school of schoolsAvailabilities"
    class="availability-tag"
    title="{{ school.available ? 'Available' : 'Unavailable' }}"
  >
    <nz-tag *ngIf="school.available" [nzColor]="'green'">{{
      school.slug
    }}</nz-tag>
    <nz-tag *ngIf="!school.available" nzTool [nzColor]="'volcano'">{{
      school.slug
    }}</nz-tag>
  </div>

  <div>
    <h4>Reviews:</h4>
    <div *ngFor="let review of allBookReviews">
      Rate:
      <nz-rate
        [(ngModel)]="review.note"
        [nzTooltips]="tooltips"
        nzAllowHalf
        nzDisabled
      ></nz-rate>

      <p>{{ review.reviewer.name }}: {{ review.comment }}</p>
    </div>
  </div>
</div>
