<p *ngIf="loading">Loading...</p>
<div *ngIf="!loading">
  <h3>{{ bookData.title }}</h3>

  <div>
    Global rating:
    <nz-rate
      [(ngModel)]="bookNotes"
      [nzTooltips]="tooltips"
      nzAllowHalf
      nzDisabled
    ></nz-rate
    >({{ bookData.reviews.totalCount }})
  </div>

  <!-- <img
    src="{{ bookData.cover }}"
    alt="Book Cover"
    #bookCover
    (error)="
      bookCover.onerror = null;
      bookCover.src = '../assets/images/book-cover-placeholder.png'
    "
  /> -->

  <p *ngIf="bookData.editor">Edited by: {{ bookData.editor }}</p>

  <div *ngIf="BookAvailability && bookInMySchool">
    <p>
      Available
      <span *ngIf="bookData.format === 'PHYSICAL'">PHYSICAL</span>
      <span *ngIf="bookData.format === 'EBOOK'">EBOOK</span>
      <span *ngIf="bookData.format === 'BOTH'">Both PHYSICAL and EBOOK</span>
    </p>
    <button type="button" (click)="rentCurrentBook()">RENT</button>
  </div>

  <div *ngIf="BookAvailability === false">
    <div *ngIf="bookBorrowerUID === user.owner.uid">
      <p>
        You've borrowed this book, consider returning it when you finish reading
        it please.
      </p>
      <button type="button" (click)="returnCurrentBook()">RETURN BOOK</button>
    </div>

    <div *ngIf="bookBorrowerUID !== user.owner.uid">
      Not available, borrowed by: <span>{{ bookBorrowerName }}</span>
    </div>
  </div>

  <div *ngIf="bookInMySchool === false">
    This book isn't available at your school!
  </div>

  <div>
    <span>My rating: </span>
    <nz-rate
      [(ngModel)]="bookReview"
      [nzTooltips]="tooltips"
      (ngModelChange)="sendBookReview()"
    ></nz-rate>
  </div>
  <div>
    <button routerLink="/books/{{ isbn }}/edit" type="button">EDIT</button>
  </div>

  <h4 style="margin-bottom: 12px;">
    Availabilities:
  </h4>
  <div
    *ngFor="let school of schoolsAvailabilities"
    class="availability-tag"
    title="{{ school.available ? 'Available' : 'Unavailable' }}"
  >
    <nz-tag *ngIf="school.available" [nzColor]="'green'">{{
      school.slug
    }}</nz-tag>
    <nz-tag *ngIf="!school.available" nzTool [nzColor]="'volcano'">{{
      school.slug
    }}</nz-tag>
  </div>

  <div class="comments-section">
    <h4>Reviews:</h4>
    <div class="comment-container" *ngFor="let review of allBookReviews">
      <div class="reviewer-rate">
        <nz-rate
          [(ngModel)]="review.note"
          [nzTooltips]="tooltips"
          nzAllowHalf
          nzDisabled
        ></nz-rate>
      </div>
      <nz-comment
        nzAuthor="{{ review.reviewer.name }}"
        [nzDatetime]="formatCommentDate(review.createdAt.iso.datetime)"
      >
        <nz-avatar
          nz-comment-avatar
          [nzShape]="'square'"
          nzIcon="user"
        ></nz-avatar>
        <nz-comment-content>
          <p>
            {{ review.comment }}
          </p>
        </nz-comment-content>
      </nz-comment>
    </div>
  </div>

  <nz-comment>
    <nz-avatar nz-comment-avatar [nzShape]="'square'" nzIcon="user"></nz-avatar>
    <nz-comment-content>
      <nz-form-item>
        <textarea [(ngModel)]="inputValue" nz-input rows="4"></textarea>
      </nz-form-item>
      <nz-form-item>
        <button
          nz-button
          nzType="primary"
          [nzLoading]="submitting"
          [disabled]="!inputValue"
          (click)="handleSubmit()"
        >
          Add Comment
        </button>
      </nz-form-item>
    </nz-comment-content>
  </nz-comment>

  Don't forget to push your review to allBookReviews when you comment
</div>
